<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mybatis.mapper.deal">

	<!-- 거래내역 추가 -->
	<insert id="insertDeal" parameterType="dealInsertDto">
		INSERT INTO deal(deal_no, product_no, seller_no, customer_no, customer_name, customer_hp, 
						customer_zipcode, customer_address, customer_address_detail, deal_delivery_message)
		 values(#{deal_no}, #{product_no}, #{seller_no}, #{customer_no}, #{customer_name}, #{customer_hp}, 
		 		#{customer_zipcode}, #{customer_address}, #{customer_address_detail}, #{deal_delivery_message})
	</insert>
	
	<!-- 사용자 주소 업데이트 -->
	<update id="updateAddress" parameterType="map">
		UPDATE MEMBER
		 SET member_zipcode = #{member_zipcode}, member_address = #{member_address}, member_address_detail = #{member_address_detail}
		 WHERE member_no = #{member_no}
	</update>
	
	<!-- 거래내역 목록 -->
	<select id="searchDealList" parameterType="map" resultType="map">
		SELECT *
		FROM deal_view 
		<choose>
			<when test="condition == 'sell'">
				 WHERE seller_no = #{member_no} 
			</when>
			<when test="condition == 'buy'">
				 WHERE customer_no = #{member_no} 
			</when>
		</choose>
		<choose>
			<when test="state != null and state != ''">
				 AND deal_state = #{state} 
			</when>
			<otherwise>
				 AND deal_state IN (0, 1, 2, 3) 
			</otherwise>
		</choose>
	</select>
	
	<!-- 거래내역 상세보기 -->
	<select id="searchDealInfo" parameterType="string" resultType="map">
	SELECT * 
	FROM deal_info_view 
	WHERE deal_no = #{deal_no}
	</select>
	
</mapper>