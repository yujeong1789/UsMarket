<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mybatis.mapper.member">
	<!-- 회원 등록 -->
	<insert id="insertMember" parameterType="memberDto">
		<selectKey keyProperty="member_no" resultType="Integer" order="BEFORE">
			select member_seq.nextval from dual
		</selectKey>
		insert into member (MEMBER_NO,MEMBER_NAME,MEMBER_ID,MEMBER_PASSWORD,MEMBER_IMAGE,
		MEMBER_EMAIL,MEMBER_HP,MEMBER_NICKNAME,
		MEMBER_ZIPCODE,MEMBER_ADDRESS,MEMBER_ADDRESS_DETAIL) 
		values (#{member_no},#{member_name},#{member_id},#{member_password},#{member_image},
		#{member_email},#{member_hp},#{member_nickname},
		#{member_zipcode},#{member_address},#{member_address_detail})
	</insert>

	<!-- 닉네임 중복 검사 -->
	<select id="overlappedNick" parameterType="String" resultType="int">
		select count(MEMBER_NICKNAME) From member where MEMBER_NICKNAME=#{member_nick}
	</select>
	
	<!-- 아이디 중복 검사 -->
	<select id="overlappedID" parameterType="String" resultType="int">
		select count(MEMBER_ID) From member where MEMBER_ID=#{member_id}
	</select>
	
	<!-- 이메일 중복 검사 -->
	<select id="overlappedEmail" parameterType="String" resultType="int">
		select count(MEMBER_EMAIL) From member where MEMBER_EMAIL=#{member_email}
	</select>
	
	<!-- 회원 이미지 등록 -->
	<select id="idLogin" parameterType="String" resultType="map">
		SELECT MEMBER_NO,MEMBER_ID,MEMBER_PASSWORD FROM MEMBER WHERE MEMBER_ID = #{member_id}
	</select>
	
	<!-- 회원 정보 검색 -->
	<select id="memberSearch" parameterType="Integer" resultType="memberDto">
		SELECT * FROM MEMBER WHERE MEMBER_NO = #{member_no}
	</select>
	
	<!-- 마이페이지 상품 출력 -->
	<select id="searchMypageProduct" parameterType="Integer" resultType="map">
		<![CDATA[ 
		SELECT product_no, product_name, product_price, product_img_path, product_regdate, product_state_no
		 FROM product_view 
		 WHERE seller_no IN #{member_no} AND member_state_no = 1 AND rownum <= 15
		]]>
	</select>
		
	<!-- 마이페이지 판매 중인 상품 수 출력 -->
	<select id="searchMypageProductCount" parameterType="Integer" resultType="int">
		SELECT count(*) 
		 FROM product_view 
		 WHERE seller_no = #{member_no}
	</select>
	
	<!-- 마이페이지 찜 출력 -->
	<select id="searchMypageBookmark" parameterType="Integer" resultType="map">
		<![CDATA[ 
		SELECT product_no, product_name, product_price, product_img_path, product_regdate, product_state_no
		FROM product_view
		WHERE product_no IN (select DISTINCT(product_no) from bookmark where member_no = #{member_no}) AND member_state_no = 1 AND rownum <= 15
		]]>		
	</select>
	
	<!-- 마이페이지 찜 중인 상품 수 출력 -->
	<select id="searchMypageBookmarkCount" parameterType="Integer" resultType="int">
		SELECT COUNT(DISTINCT(product_no)) FROM bookmark WHERE member_no = #{member_no}
	</select>
</mapper>